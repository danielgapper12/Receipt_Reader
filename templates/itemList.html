{% extends "base.html" %}
{% block content %}
   
<body>
    <header>
        <h1>Splitting Page</h1>
        
    </header>

    <nav>
        <h2>Purchaser List</h2>
        <p style="margin-right: 10px; font-size: 16px;">Purchasers:</p>
            <div id="purchasersContainer">
                <div class="item_list">
                    <input type="text" class="fullName" placeholder="Full Name" style="margin-right: 10px" oninput="updateInitials(this)">
                    <input type="text" class="initials" placeholder="Initials" readonly>
                </div>
                <div class="item_list">
                    <input type="text" class="fullName" placeholder="Full Name" style="margin-right: 10px;" oninput="updateInitials(this)">
                    <input type="text" class="initials" placeholder="Initials" readonly>
                </div>
            </div>
            <button onclick="addItem()">Add Purchaser</button>

            <script>
                function updateInitials(element) {
                    var fullName = element.value;
                    var initials = fullName.split(' ').map((n) => n[0]).join('');
                    // Find the closest parent with the class 'item_list'
                    var itemList = element.closest('.item_list');
                    // Within this 'item_list', find the element with class 'initials'
                    var initialsInput = itemList.querySelector('.initials');
                    initialsInput.value = initials.toUpperCase();
                }

                function addItem() {
                    // Create a new div with class 'item_list'
                    var newItemList = document.createElement('div');
                    newItemList.className = 'item_list';

                    // Create the fullName input
                    var fullNameInput = document.createElement('input');
                    fullNameInput.type = 'text';
                    fullNameInput.className = 'fullName';
                    fullNameInput.placeholder = 'Full Name';
                    fullNameInput.style.marginRight = '10px';
                    fullNameInput.oninput = function() { updateInitials(this); };

                    // Create the initials input
                    var initialsInput = document.createElement('input');
                    initialsInput.type = 'text';
                    initialsInput.className = 'initials';
                    initialsInput.placeholder = 'Initials';
                    initialsInput.readOnly = true;

                    // Append the inputs to the newItemList div
                    newItemList.appendChild(fullNameInput);
                    newItemList.appendChild(initialsInput);

                    // Append the newItemList div to the container
                    document.getElementById('purchasersContainer').appendChild(newItemList);
                }
            </script>
    </nav>
    <nav>
    <h2>Item List</h2>
    <ul id="itemsContainer">
        <!-- Dynamically added item lines will go here -->
    </ul>
    </nav>

    <script>
        const optionsM = [
            { value: 'option1', text: 'AT' },
            { value: 'option2', text: 'DG' },
            { value: 'option3', text: 'HI' },
            { value: 'option4', text: 'WW' }
        ];

        function addItemLine(itemText, priceText, options, containerId) {
            // Create the item line container
            const itemLine = document.createElement('div');
            itemLine.className = 'item_line';

            // Create the initials box and select element
            const initialsBox = document.createElement('div');
            initialsBox.className = 'initials-box';
            const select = document.createElement('select');
            // Generate a unique ID for the select element
            const selectId = `initialSelect-${Math.random().toString(36).substr(2, 9)}`;
            select.id = selectId;
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option.value;
                optionElement.textContent = option.text;
                select.appendChild(optionElement);
            });
            initialsBox.appendChild(select);

            // Create the item box
            const itemBox = document.createElement('div');
            itemBox.className = 'item-box';
            itemBox.contentEditable = true;
            itemBox.textContent = itemText;

            // Create the price box
            const priceBox = document.createElement('div');
            priceBox.className = 'price-box';
            priceBox.contentEditable = true;
            priceBox.textContent = priceText;

            // Append all to itemLine
            itemLine.appendChild(initialsBox);
            itemLine.appendChild(itemBox);
            itemLine.appendChild(priceBox);

            // Add the item line to the container
            document.getElementById(containerId).appendChild(itemLine);

            // Add event listener to the select element
            document.getElementById(selectId).addEventListener('change', function() {
                var selectedValue = this.value;
                console.log("Selected value: " + selectedValue);
            });
        }

        // Example usage
        document.addEventListener('DOMContentLoaded', () => {
            const options1 = [
                { value: 'option1', text: 'AT' },
                { value: 'option2', text: 'DG' },
                { value: 'option3', text: 'HI' },
                { value: 'option4', text: 'WW' }
            ];
            addItemLine('Bananas', '$1.49', options1, 'itemsContainer');
            // Call addItemLine as many times as needed with different parameters to add more items
            const options2 = [
                { value: 'option1', text: 'BG' },
                { value: 'option2', text: 'DG' },
                { value: 'option3', text: 'HI' },
                { value: 'option4', text: 'WW' }
            ];
            addItemLine('Apples', '$2.49', options2, 'itemsContainer');
        });

        const addButton = document.createElement('button');
        addButton.textContent = 'Add Item';
        addButton.onclick = function() {
            // Call addItemLine as many times as needed with different parameters to add more items
            const options = [
                { value: 'option1', text: 'BG' },
                { value: 'option2', text: 'DG' },
                { value: 'option3', text: 'HI' },
                { value: 'option4', text: 'WW' }
            ];
            addItemLine('New Item', '$2.99', options, 'itemsContainer');
        };

        document.getElementById('itemsContainer').appendChild(addButton);

        addButton.click();
    </script>


   
</body>
</html>

{% endblock %}